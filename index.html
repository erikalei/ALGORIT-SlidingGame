
<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>NUMSHIFT - Sliding Puzzle Game</title>
Â  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
Â <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="top-right-buttons" id="global-top-right-buttons">
Â  <button class="button" onclick="goBack()">â¬…ï¸ Back</button>
Â  <button class="button" onclick="openSettings()">âš™ï¸ Settings</button>
</div>

<div id="welcome-screen" class="screen active">
Â  <h2>ğŸ® NUMSHIFT - Sliding Puzzle Game</h2>
Â  <input type="text" id="username" placeholder="Enter your username" />
Â  <button class="button" onclick="startGameSetup()">Start Game</button>
</div>

<div id="player-screen" class="screen">
Â  <h2>Welcome, <span id="player-name">Player</span></h2>
Â  <p>Your Game ID: <span id="game-id"></span></p>
Â  <p>Select your difficulty</p>
Â  <button class="button" onclick="selectDifficulty('easy')">Easy</button>
Â  <button class="button" onclick="selectDifficulty('medium')">Medium</button>
Â  <button class="button" onclick="selectDifficulty('hard')">Hard</button>
</div>

<div id="levels-screen" class="screen">
Â  <h2>ğŸ§© Select Level</h2>
Â  <div id="levels"></div>
Â  <div id="leaderboard-section">
Â  Â  <div id="leaderboard-title">ğŸ† Leaderboard (Best Times & Moves)</div>
Â  Â  <table id="leaderboard-table">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th>Level</th>
Â  Â  Â  Â  Â  <th>Time (s)</th>
Â  Â  Â  Â  Â  <th>Moves</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody id="leaderboard-body">
Â  Â  Â  Â  <!-- leaderboard rows go here -->
Â  Â  Â  </tbody>
Â  Â  </table>
Â  </div>
</div>

<div id="game-screen" class="screen">
Â  <h2>ğŸ§  Puzzle In Progress</h2>
Â  <p>Moves: <span id="move-counter">0</span></p>
Â  <p>Time: <span id="timer">0</span> seconds</p>
Â  <div class="grid" id="grid"></div>
Â  <div style="display: flex; justify-content: center; flex-wrap: wrap; gap:10px; margin-top: 5px;">
Â  Â  <button class="button" id="undo-button" onclick="undoMove()" disabled>â†©ï¸ Undo Move</button>
Â  Â  <button class="button" id="pause-button" onclick="togglePause()">â¸ï¸ Pause Timer</button>
Â  Â  <button class="button" id="skip-button" onclick="skipLevel()">â­ï¸ Skip Level</button>
Â  Â  <button class="button" id="show-solution-button" onclick="showSolution()">ğŸ” Show Solution</button>
Â  Â  <button class="button" onclick="resetGame()">ğŸ” Reset</button>
Â  </div>
Â  <audio id="move-sound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YRAAAAAA"></audio>
Â  <audio id="win-sound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YRAAAAAA"></audio>
</div>

<div id="settings-screen" class="screen">
Â  <h2>âš™ï¸ Settings</h2>
Â  <div class="settings-section">
Â  Â  <label for="music-volume">ğŸµ Background Music Volume: <span id="music-volume-label">50%</span></label>
Â  Â  <input type="range" id="music-volume" min="0" max="100" value="50" />
Â  </div>
Â  <div class="settings-section">
Â  Â  <label for="sfx-volume">ğŸ”Š Sound Effects Volume: <span id="sfx-volume-label">50%</span></label>
Â  Â  <input type="range" id="sfx-volume" min="0" max="100" value="50" />
Â  </div>
Â  <div class="settings-section" style="display: flex; align-items: center; gap: 10px;">
Â  Â  <label for="sfx-toggle" style="margin:0;">ğŸ”ˆ Sound Effects: </label>
Â  Â  <input type="checkbox" id="sfx-toggle" checked />
Â  </div>
Â  <div style="width: 100%; text-align: left; margin-bottom: 15px;">
Â  Â  <label>â“ How to Play:</label>
Â  Â  <p style="font-size: 14px; line-height: 1.4;">
Â  Â  Â  Rearrange the numbered tiles by sliding them into the empty space.<br/>
Â  Â  Â  Complete the puzzle by arranging the tiles in ascending order.<br/>
Â  Â  Â  Use the Undo and Pause buttons as needed.<br/>
Â  Â  Â  Your moves and time are recorded on the leaderboard.<br/>
Â  Â  </p>
Â  </div>
Â  <div style="width: 100%; text-align: left;">
Â  Â  <label>ğŸ“Œ Additional Features:</label>
Â  Â  <ul style="font-size: 14px; line-height: 1.4;">
Â  Â  Â  <li>Show Solution to briefly preview the solved puzzle.</li>
Â  Â  Â  <li>Pause and resume the timer at any time.</li>
Â  Â  Â  <li>Undo one move to correct mistakes.</li>
Â  Â  Â  <li>Skip current level to advance.</li>
Â  Â  </ul>
Â  </div>
</div>

<!-- Congratulatory Modal -->
<div id="congratulations-modal" class="modal">
Â  <div class="modal-content">
Â  Â  <span class="close" onclick="closeModal()">&times;</span>
Â  Â  <h2>ğŸ‰ Congrats! You finished Level <span id="modal-level"></span>!</h2>
Â  Â  <p>You completed it in <span id="modal-time"></span> seconds with <span id="modal-moves"></span> moves!</p>
Â  Â  <div class="modal-buttons">
Â  Â  Â  <button class="button" onclick="nextLevel()">Next Level</button>
Â  Â  Â  <button class="button" onclick="goBackToDifficulty()">Back to Difficulty</button>
Â  Â  </div>
Â  </div>
</div>

<audio id="background-music" loop preload="auto" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_629c7defad.mp3?filename=ambient-cinematic-music-background-11490.mp3"></audio>

<script>
Â  // Variables
Â  let difficulty = "easy";
Â  let currentLevel = 1;
Â  let maxLevel = 5;
Â  let gridSize;
Â  let tiles = [];
Â  let emptyTile;
Â  let completedLevels = 1;
Â  let moveCounter = 0;
Â  let timer;
Â  let timeElapsed = 0;
Â  let timerPaused = false;
Â  let gameId = Math.floor(Math.random() * 100000); // Generate a random game ID

Â  // Track last move for undo
Â  let lastMove = null; // { fromIndex, toIndex }

Â  // Store solution state for showSolution
Â  let solutionTiles = [];

Â  // Audio elements for feedback
Â  const moveSoundElem = document.getElementById("move-sound");
Â  const winSoundElem = document.getElementById("win-sound");
Â  const backgroundMusic = document.getElementById("background-music");

Â  let audioContext;

Â  // Sound effect enabled toggle
Â  let sfxEnabled = true;

Â  // Sound effects volume (default 50%)
Â  let sfxVolume = 50;

Â  // Store history for back navigation
Â  const screenHistory = [];

Â  // User name storage
Â  let usernameStored = "";

Â  // Backgrounds array for each level
Â  let backgrounds = [
Â  Â  "linear-gradient(135deg, #001f3f, #003366)",
Â  Â  "linear-gradient(135deg, #4b0082, #8a2be2)",
Â  Â  "linear-gradient(135deg, #ff7e5f, #feb47b)",
Â  Â  "linear-gradient(135deg, #00c6ff, #0072ff)",
Â  Â  "linear-gradient(135deg, #ffafbd, #ffc3a0)"
Â  ];

Â  // Setup audio context and play music on user interaction
Â  function initAudioContext() {
Â  Â  if (!audioContext) {
Â  Â  Â  audioContext = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  Â  // Connect background music to audio context destination
Â  Â  Â  const source = audioContext.createMediaElementSource(backgroundMusic);
Â  Â  Â  source.connect(audioContext.destination);
Â  Â  Â  try {
Â  Â  Â  Â  audioContext.resume();
Â  Â  Â  } catch(e) {}
Â  Â  Â  backgroundMusic.volume = musicVolume / 100;
Â  Â  Â  if (!backgroundMusic.playing) {
Â  Â  Â  Â  backgroundMusic.play().catch(() => {});
Â  Â  Â  }
Â  Â  }
Â  }

Â  // Play move sound if SFX enabled, with volume control
Â  function playMoveSound() {
Â  Â  if (!sfxEnabled) return;
Â  Â  const ctx = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  const gainNode = ctx.createGain();
Â  Â  gainNode.gain.value = sfxVolume / 100;
Â  Â  const osc = ctx.createOscillator();
Â  Â  osc.type = "sine";
Â  Â  osc.frequency.value = 400;
Â  Â  osc.connect(gainNode);
Â  Â  gainNode.connect(ctx.destination);
Â  Â  osc.start();
Â  Â  osc.stop(ctx.currentTime + 0.1);
Â  }

Â  // Play win sound if SFX enabled, with volume control
Â  function playWinSound() {
Â  Â  if (!sfxEnabled) return;
Â  Â  const ctx = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  const gainNode = ctx.createGain();
Â  Â  gainNode.gain.value = sfxVolume / 100;
Â  Â  const osc = ctx.createOscillator();
Â  Â  osc.type = "triangle";
Â  Â  osc.frequency.setValueAtTime(800, ctx.currentTime);
Â  Â  osc.connect(gainNode);
Â  Â  gainNode.connect(ctx.destination);
Â  Â  osc.start();
Â  Â  osc.stop(ctx.currentTime + 0.3);
Â  }

Â  // Helper to switch screens with history tracking
Â  function switchScreen(from, to, trackHistory=true) {
Â  Â  if (trackHistory && from !== to) {
Â  Â  Â  screenHistory.push(from);
Â  Â  }
Â  Â  document.getElementById(from).classList.remove("active");
Â  Â  document.getElementById(to).classList.add("active");
Â  Â  updateTopButtonsVisibility(to);
Â  }

Â  // Show or hide the top-right buttons on specific screens
Â  function updateTopButtonsVisibility(screenId) {
Â  Â  const buttons = document.getElementById("global-top-right-buttons");
Â  Â  if(screenId === "welcome-screen") {
Â  Â  Â  buttons.style.display = "none";
Â  Â  } else {
Â  Â  Â  buttons.style.display = "flex";
Â  Â  }
Â  }

Â  // Go back in screen history (if any)
Â  function goBack() {
Â  Â  if (screenHistory.length > 0) {
Â  Â  Â  let lastScreen = screenHistory.pop();
Â  Â  Â  const currentScreen = document.querySelector(".screen.active").id;
Â  Â  Â  document.getElementById(currentScreen).classList.remove("active");
Â  Â  Â  document.getElementById(lastScreen).classList.add("active");
Â  Â  Â  updateTopButtonsVisibility(lastScreen);
Â  Â  }
Â  }

Â  function startGameSetup() {
Â  Â  const username = document.getElementById("username").value.trim();
Â  Â  usernameStored = username || "Player 1";
Â  Â  document.getElementById("player-name").textContent = usernameStored;
Â  Â  document.getElementById("game-id").textContent = gameId;
Â  Â  switchScreen("welcome-screen", "player-screen");
Â  Â  initAudioContext();
Â  }

Â  function selectDifficulty(selected) {
Â  Â  difficulty = selected;
Â  Â  switchScreen("player-screen", "levels-screen");
Â  Â  showLevels();
Â  }

Â  function showLevels() {
Â  Â  let levelsDiv = document.getElementById("levels");
Â  Â  levelsDiv.innerHTML = "";
Â  Â  for (let i = 1; i <= maxLevel; i++) {
Â  Â  Â  let btn = document.createElement("button");
Â  Â  Â  btn.innerText = `Level ${i}`;
Â  Â  Â  btn.className = "button";
Â  Â  Â  btn.disabled = i > completedLevels;
Â  Â  Â  btn.onclick = () => startGame(i);
Â  Â  Â  levelsDiv.appendChild(btn);
Â  Â  }
Â  Â  updateLeaderboard();
Â  }

Â  function startGame(level) {
Â  Â  currentLevel = level;
Â  Â  gridSize = level + 2;
Â  Â  switchScreen("levels-screen", "game-screen");
Â  Â  changeBackground();
Â  Â  initGrid();
Â  Â  startTimer();
Â  }

Â  function initGrid() {
Â  Â  let grid = document.getElementById("grid");
Â  Â  grid.innerHTML = "";
Â  Â  grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
Â  Â  tiles = [];
Â  Â  let numbers = Array.from({ length: gridSize * gridSize }, (_, i) => i);
Â  Â  shuffleArray(numbers);
Â  Â  solutionTiles = [];
Â  Â  numbers.forEach((num) => solutionTiles.push(num));
Â  Â  numbers.forEach((num, index) => {
Â  Â  Â  let tile = document.createElement("div");
Â  Â  Â  tile.classList.add("tile");
Â  Â  Â  if (num === 0) {
Â  Â  Â  Â  tile.classList.add("empty");
Â  Â  Â  Â  emptyTile = { index, element: tile };
Â  Â  Â  Â  tile.textContent = "";
Â  Â  Â  Â  tile.onclick = null;
Â  Â  Â  } else {
Â  Â  Â  Â  tile.textContent = num;
Â  Â  Â  Â  tile.onclick = () => moveTile(index);
Â  Â  Â  }
Â  Â  Â  tiles.push(tile);
Â  Â  Â  grid.appendChild(tile);
Â  Â  });
Â  Â  moveCounter = 0;
Â  Â  timeElapsed = 0;
Â  Â  timerPaused = false;
Â  Â  document.getElementById("move-counter").textContent = moveCounter;
Â  Â  document.getElementById("timer").textContent = timeElapsed;
Â  Â  lastMove = null;
Â  Â  document.getElementById("undo-button").disabled = true;
Â  Â  document.getElementById("pause-button").textContent = "â¸ï¸ Pause Timer";
Â  }

Â  function moveTile(index) {
Â  Â  if(timerPaused) return;
Â  Â  let row = Math.floor(index / gridSize);
Â  Â  let col = index % gridSize;
Â  Â  let emptyRow = Math.floor(emptyTile.index / gridSize);
Â  Â  let emptyCol = emptyTile.index % gridSize;
Â  Â  if ((Math.abs(row - emptyRow) === 1 && col === emptyCol) ||
Â  Â  Â  Â  (Math.abs(col - emptyCol) === 1 && row === emptyRow)) {
Â  Â  Â  swapTiles(index, emptyTile.index);
Â  Â  Â  moveCounter++;
Â  Â  Â  document.getElementById("move-counter").textContent = moveCounter;
Â  Â  Â  lastMove = { fromIndex: index, toIndex: emptyTile.index };
Â  Â  Â  document.getElementById("undo-button").disabled = false;
Â  Â  Â  playMoveSound();
Â  Â  }
Â  }

Â  function swapTiles(tileIndex, emptyIndex) {
Â  Â  let tempText = tiles[tileIndex].textContent;
Â  Â  tiles[tileIndex].textContent = "";
Â  Â  tiles[tileIndex].classList.add("empty");
Â  Â  tiles[tileIndex].onclick = null;
Â  Â  tiles[emptyIndex].textContent = tempText;
Â  Â  tiles[emptyIndex].classList.remove("empty");
Â  Â  tiles[emptyIndex].onclick = () => moveTile(emptyIndex);
Â  Â  emptyTile.index = tileIndex;
Â  Â  emptyTile.element = tiles[tileIndex];
Â  Â  checkWin();
Â  }

Â  function undoMove() {
Â  Â  if (!lastMove) return;
Â  Â  if(timerPaused) return;
Â  Â  swapTiles(lastMove.toIndex, lastMove.fromIndex);
Â  Â  moveCounter = Math.max(0, moveCounter - 1);
Â  Â  document.getElementById("move-counter").textContent = moveCounter;
Â  Â  lastMove = null;
Â  Â  document.getElementById("undo-button").disabled = true;
Â  Â  playMoveSound();
Â  }

Â  function checkWin() {
Â  Â  for (let i = 0; i < tiles.length; i++) {
Â  Â  Â  if (i === tiles.length - 1) {
Â  Â  Â  Â  if (!tiles[i].classList.contains("empty")) return;
Â  Â  Â  } else {
Â  Â  Â  Â  if (tiles[i].textContent != i + 1) return;
Â  Â  Â  }
Â  Â  }
Â  Â  clearInterval(timer);
Â  Â  playWinSound();
Â  Â  showCongratulationsModal();
Â  Â  completedLevels = Math.max(completedLevels, currentLevel + 1);
Â  Â  showLevels();
Â  }

Â  function shuffleArray(arr) {
Â  Â  for (let i = arr.length - 1; i > 0; i--) {
Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  Â  [arr[i], arr[j]] = [arr[j], arr[i]];
Â  Â  }
Â  }

Â  function startTimer() {
Â  Â  clearInterval(timer);
Â  Â  timerPaused = false;
Â  Â  document.getElementById("pause-button").textContent = "â¸ï¸ Pause Timer";
Â  Â  timeElapsed = 0;
Â  Â  document.getElementById("timer").textContent = timeElapsed;
Â  Â  timer = setInterval(() => {
Â  Â  Â  timeElapsed++;
Â  Â  Â  document.getElementById("timer").textContent = timeElapsed;
Â  Â  }, 1000);
Â  }

Â  // Toggle pause/resume timer
Â  function togglePause() {
Â  Â  if (!timer) return;
Â  Â  if(timerPaused){
Â  Â  Â  timerPaused = false;
Â  Â  Â  document.getElementById("pause-button").textContent = "â¸ï¸ Pause Timer";
Â  Â  Â  timer = setInterval(() => {
Â  Â  Â  Â  timeElapsed++;
Â  Â  Â  Â  document.getElementById("timer").textContent = timeElapsed;
Â  Â  Â  }, 1000);
Â  Â  } else {
Â  Â  Â  timerPaused = true;
Â  Â  Â  document.getElementById("pause-button").textContent = "â–¶ï¸ Resume Timer";
Â  Â  Â  clearInterval(timer);
Â  Â  }
Â  }

Â  // Skip current level and go to next
Â  function skipLevel() {
Â  Â  closeModal();
Â  Â  if(currentLevel < maxLevel){
Â  Â  Â  currentLevel++;
Â  Â  Â  startGame(currentLevel);
Â  Â  } else {
Â  Â  Â  alert("You have reached the last level.");
Â  Â  }
Â  }

Â  function resetGame() {
Â  Â  clearInterval(timer);
Â  Â  initGrid();
Â  Â  startTimer();
Â  Â  lastMove = null;
Â  Â  document.getElementById("undo-button").disabled = true;
Â  }

Â  // Show the solved puzzle state briefly flashing the solved tiles
Â  function showSolution() {
Â  Â  disableGameControls(true);
Â  Â  const backupTexts = tiles.map(t => t.textContent);
Â  Â  const backupClasses = tiles.map(t => t.className);
Â  Â  for(let i=0; i<tiles.length; i++){
Â  Â  Â  if(i === tiles.length-1){
Â  Â  Â  Â  tiles[i].textContent = "";
Â  Â  Â  Â  tiles[i].className = "tile empty";
Â  Â  Â  Â  tiles[i].onclick = null;
Â  Â  Â  } else {
Â  Â  Â  Â  tiles[i].textContent = (i+1).toString();
Â  Â  Â  Â  tiles[i].className = "tile";
Â  Â  Â  Â  tiles[i].onclick = () => moveTile(i);
Â  Â  Â  }
Â  Â  }
Â  Â  setTimeout(() => {
Â  Â  Â  for(let i=0; i<tiles.length; i++){
Â  Â  Â  Â  tiles[i].textContent = backupTexts[i];
Â  Â  Â  Â  tiles[i].className = backupClasses[i];
Â  Â  Â  Â  if(!tiles[i].classList.contains("empty")){
Â  Â  Â  Â  Â  tiles[i].onclick = () => moveTile(i);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  tiles[i].onclick = null;
Â  Â  Â  Â  Â  emptyTile = { index: i, element: tiles[i] };
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  disableGameControls(false);
Â  Â  }, 3000);
Â  }

Â  function disableGameControls(disable) {
Â  Â  document.getElementById("undo-button").disabled = disable || lastMove === null;
Â  Â  document.getElementById("pause-button").disabled = disable;
Â  Â  document.querySelector("#game-screen button[onclick='showSolution()']").disabled = disable;
Â  Â  document.querySelector("#game-screen button[onclick='resetGame()']").disabled = disable;
Â  Â  document.getElementById("skip-button").disabled = disable;
Â  }

Â  // Leaderboard Implementation
Â  function updateLeaderboard(){
Â  Â  const tbody = document.getElementById("leaderboard-body");
Â  Â  tbody.innerHTML = "";
Â  Â  let data = getLeaderboardData();
Â  Â  for(let lvl=1; lvl<=maxLevel; lvl++){
Â  Â  Â  let tr = document.createElement("tr");
Â  Â  Â  let tdLevel = document.createElement("td");
Â  Â  Â  tdLevel.textContent = "Level " + lvl;
Â  Â  Â  let tdTime = document.createElement("td");
Â  Â  Â  let tdMoves = document.createElement("td");
Â  Â  Â  if(data[lvl]){
Â  Â  Â  Â  tdTime.textContent = data[lvl].time;
Â  Â  Â  Â  tdMoves.textContent = data[lvl].moves;
Â  Â  Â  } else {
Â  Â  Â  Â  tdTime.textContent = "-";
Â  Â  Â  Â  tdMoves.textContent = "-";
Â  Â  Â  }
Â  Â  Â  tr.appendChild(tdLevel);
Â  Â  Â  tr.appendChild(tdTime);
Â  Â  Â  tr.appendChild(tdMoves);
Â  Â  Â  tbody.appendChild(tr);
Â  Â  }
Â  }

Â  function getLeaderboardData(){
Â  Â  let key = `leaderboard_${difficulty}`;
Â  Â  let stored = localStorage.getItem(key);
Â  Â  if(stored){
Â  Â  Â  try{
Â  Â  Â  Â  return JSON.parse(stored);
Â  Â  Â  }catch(e){
Â  Â  Â  Â  return {};
Â  Â  Â  }
Â  Â  }
Â  Â  return {};
Â  }

Â  function updateLeaderboardOnWin(){
Â  Â  let data = getLeaderboardData();
Â  Â  let level = currentLevel;
Â  Â  if(!data[level] || timeElapsed < data[level].time || (timeElapsed === data[level].time && moveCounter < data[level].moves)){
Â  Â  Â  data[level] = { time: timeElapsed, moves: moveCounter };
Â  Â  Â  let key = `leaderboard_${difficulty}`;
Â  Â  Â  localStorage.setItem(key, JSON.stringify(data));
Â  Â  }
Â  }

Â  // Settings and Back button support

Â  let musicVolume = 50;

Â  function loadSettings() {
Â  Â  const storedVolume = localStorage.getItem('musicVolume');
Â  Â  if (storedVolume !== null) {
Â  Â  Â  musicVolume = parseInt(storedVolume);
Â  Â  }
Â  Â  const storedSFX = localStorage.getItem('sfxEnabled');
Â  Â  if (storedSFX !== null) {
Â  Â  Â  sfxEnabled = storedSFX === 'true';
Â  Â  }
Â  Â  const storedSFXVolume = localStorage.getItem('sfxVolume');
Â  Â  if(storedSFXVolume !== null){
Â  Â  Â  sfxVolume = parseInt(storedSFXVolume);
Â  Â  }
Â  Â  document.getElementById('music-volume').value = musicVolume;
Â  Â  document.getElementById('music-volume-label').textContent = musicVolume + '%';
Â  Â  document.getElementById('sfx-toggle').checked = sfxEnabled;
Â  Â  document.getElementById('sfx-volume').value = sfxVolume;
Â  Â  document.getElementById('sfx-volume-label').textContent = sfxVolume + '%';
Â  Â  backgroundMusic.volume = musicVolume / 100;
Â  }

Â  function saveSettings() {
Â  Â  localStorage.setItem('musicVolume', musicVolume);
Â  Â  localStorage.setItem('sfxEnabled', sfxEnabled);
Â  Â  localStorage.setItem('sfxVolume', sfxVolume);
Â  }

Â  function openSettings() {
Â  Â  const currentScreen = document.querySelector(".screen.active").id;
Â  Â  screenHistory.push(currentScreen);
Â  Â  switchScreen(currentScreen, "settings-screen");
Â  }

Â  function closeSettings() {
Â  Â  goBack();
Â  }

Â  // Music volume slider change
Â  document.getElementById('music-volume').addEventListener('input', (e) => {
Â  Â  musicVolume = parseInt(e.target.value);
Â  Â  document.getElementById('music-volume-label').textContent = musicVolume + '%';
Â  Â  backgroundMusic.volume = musicVolume / 100;
Â  Â  saveSettings();
Â  });

Â  // Sound Effects toggle change
Â  document.getElementById('sfx-toggle').addEventListener('change', (e) => {
Â  Â  sfxEnabled = e.target.checked;
Â  Â  saveSettings();
Â  });

Â  // Sound Effects volume slider change
Â  document.getElementById('sfx-volume').addEventListener('input', (e) => {
Â  Â  sfxVolume = parseInt(e.target.value);
Â  Â  document.getElementById('sfx-volume-label').textContent = sfxVolume + '%';
Â  Â  saveSettings();
Â  });

Â  // Modal functions for congrats popup
Â  function showCongratulationsModal() {
Â  Â  document.getElementById("modal-level").textContent = currentLevel;
Â  Â  document.getElementById("modal-time").textContent = timeElapsed;
Â  Â  document.getElementById("modal-moves").textContent = moveCounter;
Â  Â  const modal = document.getElementById("congratulations-modal");
Â  Â  modal.style.display = "block";
Â  }
Â  function closeModal() {
Â  Â  const modal = document.getElementById("congratulations-modal");
Â  Â  modal.style.display = "none";
Â  }
Â  function nextLevel() {
Â  Â  closeModal();
Â  Â  if(currentLevel < maxLevel){
Â  Â  Â  currentLevel++;
Â  Â  Â  startGame(currentLevel);
Â  Â  } else {
Â  Â  Â  alert("You have reached the last level.");
Â  Â  }
Â  }
Â  function goBackToDifficulty() {
Â  Â  closeModal();
Â  Â  switchScreen(document.querySelector(".screen.active").id, "player-screen");
Â  }

Â  // Change background based on current level
Â  function changeBackground() {
Â  Â  document.body.style.background = backgrounds[currentLevel - 1] || backgrounds[0];
Â  }

Â  // Initialize leaderboard and loads settings on window load
Â  window.onload = () => {
Â  Â  showLevels();
Â  Â  loadSettings();
Â  Â  updateTopButtonsVisibility(document.querySelector(".screen.active").id);
Â  Â  // We do not autoplay music here to comply with browser policy - only start after user interaction
Â  };

Â  // Ensure background music starts after first user interaction anywhere on page
Â  function unlockAudioOnUserGesture() {
Â  Â  if (backgroundMusic.paused) {
Â  Â  Â  backgroundMusic.play().catch(() => {});
Â  Â  }
Â  Â  if (audioContext && audioContext.state === 'suspended') {
Â  Â  Â  audioContext.resume();
Â  Â  }
Â  Â  document.body.removeEventListener('click', unlockAudioOnUserGesture);
Â  Â  document.body.removeEventListener('keydown', unlockAudioOnUserGesture);
Â  }
Â  document.body.addEventListener('click', unlockAudioOnUserGesture);
Â  document.body.addEventListener('keydown', unlockAudioOnUserGesture);

</script>
</body>
</html>

